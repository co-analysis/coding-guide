<!DOCTYPE html>
<html lang="en" class="govuk-template "><head>
  <meta charset="utf-8">
  
  
  <title>Analytical Coding Guide | Writing good functions</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="theme-color" content="#0b0c0c">

  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  

  

  
  <link href="https://co-analysis.github.io/coding-guide/css/govuk-frontend-4.0.0.min.css" rel="stylesheet">
  

  

  <link href="https://co-analysis.github.io/coding-guide/css/dashboard-layout.css" rel="stylesheet">

  
  <link href="https://co-analysis.github.io/coding-guide/css/font-override.css" rel="stylesheet">
  

  
  <link href="https://co-analysis.github.io/coding-guide/css/syntax.css" rel="stylesheet">

  

  <meta property="og:image" content="https://co-analysis.github.io/coding-guide/assets/images/govuk-opengraph-image.png">

</head><body class="govuk-template__body js-enabled"><script>
    document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');

</script>

<a href="#main-content" class="govuk-skip-link">Skip to main content</a>

<header class="govuk-header " role="banner" data-module="govuk-header">
    <div class="govuk-header__container govuk-width-container">

        <div class="govuk-header__logo">
            <a href="https://co-analysis.github.io/coding-guide/" class="govuk-header__link govuk-header__link--homepage">

                

                
                <span class="govuk-header__product-name">Analytical Coding Guide</span>
                

            </a>
        </div>

    </div>
</header>


<div class="govuk-width-container">
    <div class="govuk-phase-banner">
        <p class="govuk-phase-banner__content">
            <strong class="govuk-tag govuk-phase-banner__content__tag">
                alpha
            </strong>
            <span class="govuk-phase-banner__text">
                This is a new service â€“ your <a class="govuk-link" href="https://github.com/co-analysis/coding-guide/issues/">feedback</a>
                will
                help us to improve it.
            </span>
        </p>
    </div>
</div>
<div class="govuk-width-container ">
        <main class="govuk-main-wrapper " id="main-content" role="main">
            <div class="dashboard-container">

                <div class="dashboard-nav">
<nav class="sidebar-nav">

        
        

        

        <ul class="govuk-list">

                

                

                

                
                <li class="nav-section"><a class="govuk-!-font-size-16" href="https://co-analysis.github.io/coding-guide/workflow/">Workflow</a>
                </li>
                
                

                
                

                

                

                

                
                
                

                

                
                

                

                

                

                
                <li class="nav-section"><a class="govuk-!-font-size-16" href="https://co-analysis.github.io/coding-guide/code_style/">Code style</a>
                </li>
                
                

                
                

                

                
                

                

                

                

                
                <li class="nav-section nav-active-section"><a class="govuk-!-font-size-16" href="https://co-analysis.github.io/coding-guide/functions/">Writing functions &amp; packages</a>
                </li>
                
                

                
                

                

                
                <li class="nav-item"><a class="govuk-!-font-size-14 govuk-link govuk-link--no-visited-state"
                                href="https://co-analysis.github.io/coding-guide/functions/why_functions/">Why functions?</a></li>
                

                

                

                

                
                <li class="nav-item nav-active-item"><a
                                class="govuk-!-font-size-14 govuk-link govuk-link--no-visited-state "
                                href="https://co-analysis.github.io/coding-guide/functions/good_functions/">Writing good functions</a></li>
                

                

                

                

                
                <li class="nav-item"><a class="govuk-!-font-size-14 govuk-link govuk-link--no-visited-state"
                                href="https://co-analysis.github.io/coding-guide/functions/package_requirements/">Writing packages</a></li>
                

                

                
                

                

                

                

                
                <li class="nav-section"><a class="govuk-!-font-size-16" href="https://co-analysis.github.io/coding-guide/output/">Output style</a>
                </li>
                
                

                

                

                

                

                
                <li class="nav-section"><a class="govuk-!-font-size-16" href="https://co-analysis.github.io/coding-guide/version_control/">Version control</a>
                </li>
                
                

                
                

                

                

                

                
                

                

                

                

                
                <li class="nav-section"><a class="govuk-!-font-size-16" href="https://co-analysis.github.io/coding-guide/assurance/">Assurance</a>
                </li>
                
                

                
                

                

                

                

                
                

                

                

                

                
                <li class="nav-section"><a class="govuk-!-font-size-16" href="https://co-analysis.github.io/coding-guide/technology/">Technology</a>
                </li>
                
                

                
                

                

                
                
                

                

                
                
                

                

                
                

                

                

                

                
                <li class="nav-section"><a class="govuk-!-font-size-16" href="https://co-analysis.github.io/coding-guide/reference/">Learning and reference materials</a>
                </li>
                
                

                

                

        </ul>

        

        <ul class="govuk-list nav-extra">

                
                <li class="nav-item nav-about"><a class="govuk-!-font-size-14 govuk-link govuk-link--no-visited-state"
                                href="https://co-analysis.github.io/coding-guide/about/">About this guide</a></li>
                

                </a>

        </ul>
        

</nav></div>
                <div class="dashboard-content">


<h1 class="govuk-heading-xl">Writing good functions</h1>


<div class="govuk-body">

    
<h1 id="properties-of-good-functions" class="govuk-heading-xl">Properties of good functions</h1>
<p>Each of your functions should:</p>
<ul>
<li>perform a single, small task</li>
<li>be named sensibly</li>
<li>communicate clearly with the user if required</li>
<li>fail quickly if there&rsquo;s an error</li>
</ul>
<p>You can read more about function writing in <a href="https://r4ds.had.co.nz/functions.html" class="govuk-link"  target="_blank" rel="noreferrer noopener">the Functions chapter of <em>R for Data Science</em></a>.</p>

<h2 id="be-discrete" class="govuk-heading-l">Be discrete</h2>
<p>Design your function to do the smallest possible unit of work. This makes it easier to interpret what its doing; makes it easier to discover and debug errors; and allows you reuse the function more readily across your analyses. For example, you might write functions like <code>read_data()</code>, <code>clean_data()</code> and <code>plot_results()</code>.</p>
<p>You can always write a function that combines other functions, if required. The readability of such a function will benefit from you having written the smaller functions. For example:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-r" data-lang="r"><span class="nf">run_analysis</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span> <span class="p">{</span>

  <span class="n">df</span> <span class="o">&lt;-</span> <span class="nf">read_data</span><span class="p">()</span>
  <span class="n">clean_df</span> <span class="o">&lt;-</span> <span class="nf">clean_data</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
  <span class="nf">plot_results</span><span class="p">(</span><span class="n">clean_df</span><span class="p">)</span>

<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="naming" class="govuk-heading-l">Naming</h2>
<p>The name you give your function should be short but descriptive. You should use the same principles as for naming objects in general, like preferring snake case.</p>
<p>You should, however, try to start function names with a verb, as per <a href="https://style.tidyverse.org/functions.html" class="govuk-link"  target="_blank" rel="noreferrer noopener">the Tidyverse style guide</a>. This signposts to the reader that the function is going to do something with your inputs.</p>
<p>For example, if your function summarises data by year, you could name it <code>summarise_years()</code> rather than something less helpful like <code>years_function()</code>. The latter indicates that years are involved, but doesn&rsquo;t imply what it&rsquo;s going to do.</p>

<h2 id="communication" class="govuk-heading-l">Communication</h2>
<p>If appropriate, your function should print messages in the console to communicate with the user about what&rsquo;s happening. You must supply an informative error message if something has gone wrong and it&rsquo;s advisable to provide updates to the user for functions that contain long-running processes.</p>

<h3 id="on-error" class="govuk-heading-m">On error</h3>
<p>It&rsquo;s good practice to check the inputs to a function for any problems, like if the wrong class of object has been provided. The function can then be stopped before it executes, which could save a lot of time.</p>
<p>You should use <code>if</code> and <code>stop()</code> statements at the start of a function body . In this example, the class of the input to the <code>data</code> argument is checked to make sure it&rsquo;s a dataframe. If not, the function stops and prints a message to the console.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-r" data-lang="r"><span class="n">clean_data</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="nf">if </span><span class="p">(</span><span class="nf">class</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&#34;data.frame&#34;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">stop</span><span class="p">(</span><span class="s">&#34;You must supply a data.frame to the &#39;data&#39; argument.\n&#34;</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="n">data_clean</span> <span class="o">&lt;-</span> <span class="n">data</span> <span class="o">%&gt;%</span>
    <span class="nf">select</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">%&gt;%</span> 
    <span class="nf">filter</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="s">&#34;y&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span> 
    <span class="nf">mutate</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>

  <span class="nf">return</span><span class="p">(</span><span class="n">data_clean</span><span class="p">)</span>

<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Try to be succinct but informative when writing error messages to the user. It may also be helpful to suggest a fix, where possible. This will make it far easier to debug the problem and fix it. See <a href="https://style.tidyverse.org/error-messages.html" class="govuk-link"  target="_blank" rel="noreferrer noopener">the error messages section</a> of <em>The Tidyverse Style Guide</em> for inspiration.</p>

<h3 id="to-provide-information" class="govuk-heading-m">To provide information</h3>
<p>It can be helpful to print a message to the user when certain parts of the function are complete. This is a nice convenience for long-running processes, especially.</p>
<p>You should use the <code>cat()</code> function to do this, which prints text to the console. Here&rsquo;s a simple example using our earlier example:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-r" data-lang="r"><span class="nf">run_analysis</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span> <span class="p">{</span>

  <span class="n">df</span> <span class="o">&lt;-</span> <span class="nf">read_data</span><span class="p">()</span>
  <span class="nf">cat</span><span class="p">(</span><span class="s">&#34;Finished reading data&#34;</span><span class="p">)</span>
  
  <span class="n">clean_df</span> <span class="o">&lt;-</span> <span class="nf">clean_data</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
  <span class="nf">cat</span><span class="p">(</span><span class="s">&#34;Finished cleaning data&#34;</span><span class="p">)</span>
  
  <span class="nf">plot_results</span><span class="p">(</span><span class="n">clean_df</span><span class="p">)</span>
  <span class="nf">cat</span><span class="p">(</span><span class="s">&#34;Finished plotting data&#34;</span><span class="p">)</span>

<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>Having said this, you don&rsquo;t want to overload the user with information. Keep messages succinct and provide contextual information if relevant, like the current element being iterated over or the time taken.</p>


</div>



                </div>

            </div>
        </main>
    </div><footer class="govuk-footer " role="contentinfo">
    <div class="govuk-width-container ">
        <div class="govuk-footer__meta">
            <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">

                <h2 class="govuk-visually-hidden">Support links</h2>
                <ul class="govuk-footer__inline-list">

                    

                    
                    
                    <li class="govuk-footer__inline-list-item">
                        <a class="govuk-footer__link" href="https://co-analysis.github.io/coding-guide/accessibility/">
                            Accessibility
                        </a>
                    </li>
                    
                    
                    
                    <li class="govuk-footer__inline-list-item">
                        <a class="govuk-footer__link" href="https://co-analysis.github.io/coding-guide/cookies/">
                            Cookies
                        </a>
                    </li>
                    
                    
                    
                    
                    <li class="govuk-footer__inline-list-item">
                        Built by <a class="govuk-footer__link" href="https://www.github.com/co-analysis">
                            Cabinet Office Analysis &amp; Insight
                        </a>
                    </li>
                    

                </ul>

                <svg aria-hidden="true" focusable="false" class="govuk-footer__licence-logo"
                    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 483.2 195.7" height="17" width="41">
                    <path fill="currentColor"
                        d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145" />
                </svg>
                <span class="govuk-footer__licence-description">
                    All content is available under the
                    <a class="govuk-footer__link"
                        href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
                        rel="license">Open Government Licence v3.0</a>, except where otherwise stated
                </span>
            </div>
            <div class="govuk-footer__meta-item">
                <a style="background-image:url(https://co-analysis.github.io/coding-guide/assets/images/govuk-crest.png);"
                    class="govuk-footer__link govuk-footer__copyright-logo"
                    href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/">Â©
                    Crown copyright </a>
            </div>
        </div>
    </div>
</footer>

<script type="text/javascript">

    function applyGOVUK(tag, govuk_class) {
        var elements = document.querySelector("div.dashboard-content").getElementsByTagName(tag)

        var i;
        for (i = 0; i < elements.length; i++) {
            if (elements[i].classList.contains("lntable") || elements[i].classList.contains("lntd")) {
                null;
            } else if (tag == "P" && (elements[i].classList.contains("govuk-body-l") || elements[i].classList.contains("govuk-body-s"))) {
                null;
            } else if (tag == "HR" && (elements[i].classList.contains("govuk-section-break"))) {
                null;
            } else {
                elements[i].classList.add(govuk_class);
            }

        };

    };

     
    applyGOVUK("P", "govuk-body");

     
    applyGOVUK("TABLE", "govuk-table");
    applyGOVUK("CAPTION", "govuk-table__caption");
    applyGOVUK("CAPTION", "govuk-table__caption--m");
    applyGOVUK("TR", "govuk-table__row");
    applyGOVUK("TD", "govuk-table__cell");
    applyGOVUK("THEAD", "govuk-table__head");
    applyGOVUK("TH", "govuk-table__header");

     
    applyGOVUK("BLOCKQUOTE", "govuk-inset-text");
    applyGOVUK("STRONG", "govuk-!-font-weight-bold");
    applyGOVUK("B", "govuk-!-font-weight-bold");

     
    applyGOVUK("UL", "govuk-list");
    applyGOVUK("UL", "govuk-list--bullet");
    applyGOVUK("OL", "govuk-list");
    applyGOVUK("OL", "govuk-list--number");

     
    applyGOVUK("HR", "govuk-section-break--l");
    applyGOVUK("HR", "govuk-section-break");

     
    function styleCodeBlocks() {
        var code_elements = document.querySelectorAll("div.highlight")
        var i;

        for (i = 0; i < code_elements.length; i++) {
            code_elements[i].classList.add("govuk-body");
        };
    };
    styleCodeBlocks();

     
    function restyleTOC() {

        var toc_elements = document.querySelectorAll("#page_toc #TableOfContents ul")

        var i;

        for (i = 0; i < toc_elements.length; i++) {
            toc_elements[i].classList.remove("govuk-list");
            toc_elements[i].classList.remove("govuk-list--bullet");
            toc_elements[i].classList.add("toc-list");

        };

        var toc_links = document.querySelectorAll("#page_toc #TableOfContents a")

        for (i = 0; i < toc_links.length; i++) {
            toc_links[i].classList.add("toc-link");
        };

    };
    restyleTOC();

    

</script></body>

</html>