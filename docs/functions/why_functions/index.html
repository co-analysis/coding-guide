<!DOCTYPE html>
<html lang="en" class="govuk-template "><head>
  <meta charset="utf-8">
  
  
  <title>Analytical Coding Guide | Why functions?</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="theme-color" content="#0b0c0c">

  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  

  

  
  <link href="https://co-analysis.github.io/coding-guide/css/govuk-frontend-4.0.0.min.css" rel="stylesheet">
  

  

  <link href="https://co-analysis.github.io/coding-guide/css/dashboard-layout.css" rel="stylesheet">

  
  <link href="https://co-analysis.github.io/coding-guide/css/font-override.css" rel="stylesheet">
  

  
  <link href="https://co-analysis.github.io/coding-guide/css/syntax.css" rel="stylesheet">

  

  <meta property="og:image" content="https://co-analysis.github.io/coding-guide/assets/images/govuk-opengraph-image.png">

</head><body class="govuk-template__body js-enabled"><script>
    document.body.className = ((document.body.className) ? document.body.className + ' js-enabled' : 'js-enabled');

</script>

<a href="#main-content" class="govuk-skip-link">Skip to main content</a>

<header class="govuk-header " role="banner" data-module="govuk-header">
    <div class="govuk-header__container govuk-width-container">

        <div class="govuk-header__logo">
            <a href="https://co-analysis.github.io/coding-guide/" class="govuk-header__link govuk-header__link--homepage">

                

                
                <span class="govuk-header__product-name">Analytical Coding Guide</span>
                

            </a>
        </div>

    </div>
</header>


<div class="govuk-width-container">
    <div class="govuk-phase-banner">
        <p class="govuk-phase-banner__content">
            <strong class="govuk-tag govuk-phase-banner__content__tag">
                alpha
            </strong>
            <span class="govuk-phase-banner__text">
                This is a new service â€“ your <a class="govuk-link" href="https://github.com/co-analysis/coding-guide/issues/">feedback</a>
                will
                help us to improve it.
            </span>
        </p>
    </div>
</div>
<div class="govuk-width-container ">
        <main class="govuk-main-wrapper " id="main-content" role="main">
            <div class="dashboard-container">

                <div class="dashboard-nav">
<nav class="sidebar-nav">

        
        

        

        <ul class="govuk-list">

                

                

                

                
                <li class="nav-section"><a class="govuk-!-font-size-16" href="https://co-analysis.github.io/coding-guide/workflow/">Workflow</a>
                </li>
                
                

                
                

                

                

                

                
                
                

                

                
                

                

                

                

                
                <li class="nav-section"><a class="govuk-!-font-size-16" href="https://co-analysis.github.io/coding-guide/code_style/">Code style</a>
                </li>
                
                

                
                

                

                
                

                

                

                

                
                <li class="nav-section nav-active-section"><a class="govuk-!-font-size-16" href="https://co-analysis.github.io/coding-guide/functions/">Writing functions &amp; packages</a>
                </li>
                
                

                
                

                

                
                <li class="nav-item nav-active-item"><a
                                class="govuk-!-font-size-14 govuk-link govuk-link--no-visited-state "
                                href="https://co-analysis.github.io/coding-guide/functions/why_functions/">Why functions?</a></li>
                

                

                

                

                
                <li class="nav-item"><a class="govuk-!-font-size-14 govuk-link govuk-link--no-visited-state"
                                href="https://co-analysis.github.io/coding-guide/functions/good_functions/">Writing good functions</a></li>
                

                

                

                

                
                <li class="nav-item"><a class="govuk-!-font-size-14 govuk-link govuk-link--no-visited-state"
                                href="https://co-analysis.github.io/coding-guide/functions/package_requirements/">Writing packages</a></li>
                

                

                
                

                

                

                

                
                <li class="nav-section"><a class="govuk-!-font-size-16" href="https://co-analysis.github.io/coding-guide/output/">Output style</a>
                </li>
                
                

                

                

                

                

                
                <li class="nav-section"><a class="govuk-!-font-size-16" href="https://co-analysis.github.io/coding-guide/version_control/">Version control</a>
                </li>
                
                

                
                

                

                

                

                
                

                

                

                

                
                <li class="nav-section"><a class="govuk-!-font-size-16" href="https://co-analysis.github.io/coding-guide/assurance/">Assurance</a>
                </li>
                
                

                
                

                

                

                

                
                

                

                

                

                
                <li class="nav-section"><a class="govuk-!-font-size-16" href="https://co-analysis.github.io/coding-guide/technology/">Technology</a>
                </li>
                
                

                
                

                

                
                
                

                

                
                
                

                

                
                

                

                

                

                
                <li class="nav-section"><a class="govuk-!-font-size-16" href="https://co-analysis.github.io/coding-guide/reference/">Learning and reference materials</a>
                </li>
                
                

                

                

        </ul>

        

        <ul class="govuk-list nav-extra">

                
                <li class="nav-item nav-about"><a class="govuk-!-font-size-14 govuk-link govuk-link--no-visited-state"
                                href="https://co-analysis.github.io/coding-guide/about/">About this guide</a></li>
                

                </a>

        </ul>
        

</nav></div>
                <div class="dashboard-content">


<h1 class="govuk-heading-xl">Why functions?</h1>


<div class="govuk-body">

    
<h1 id="dont-repeat-yourself" class="govuk-heading-xl">Don&rsquo;t repeat yourself</h1>
<p>Sometimes you want to apply the same code multiple times to variables in your dataset. You might do this by copy-pasting the code and altering the content slightly each time.</p>
<p>Let&rsquo;s say you have the People Survey dataset and want to save each organisation&rsquo;s data into a separate file. You might do something like this:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-r" data-lang="r"><span class="n">df</span> <span class="o">%&gt;%</span>
  <span class="nf">filter</span><span class="p">(</span><span class="n">OverallDeptCode</span> <span class="o">==</span> <span class="s">&#34;ACAS&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">write_csv</span><span class="p">(</span><span class="s">&#34;output/csps-acas-results.csv&#34;</span><span class="p">)</span>

<span class="n">df</span> <span class="o">%&gt;%</span>
  <span class="nf">filter</span><span class="p">(</span><span class="n">OverallDeptCode</span> <span class="o">==</span> <span class="s">&#34;AGO&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">write_csv</span><span class="p">(</span><span class="s">&#34;output/csps-ago-results.csv&#34;</span><span class="p">)</span>

<span class="n">df</span> <span class="o">%&gt;%</span>
  <span class="nf">filter</span><span class="p">(</span><span class="n">OverallDeptCode</span> <span class="o">==</span> <span class="s">&#34;AIB&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">write_csv</span><span class="p">(</span><span class="s">&#34;output/csps-aib-results.csv&#34;</span><span class="p">)</span>

<span class="n">df</span> <span class="o">%&gt;%</span>
  <span class="nf">filter</span><span class="p">(</span><span class="n">OverallDeptCode</span> <span class="o">==</span> <span class="s">&#34;ALOB&#34;</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="nf">write_csv</span><span class="p">(</span><span class="s">&#34;output/csps-acas-results.csv&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>This example code takes an input dataset <code>df</code>, filters it for a named governmental organisation, then saves the output as a CSV file to a provided filepath. Over 100 organisations took part, so you&rsquo;ll have to copy the code a lot.</p>
<p>In fact, did you notice that the CSV filepath is wrong in the last line of the example? This error is likely to happen because you have to modify both the <code>filter()</code> and <code>write_csv()</code> statements for each organisation. It would be better if we only had to do that once.</p>
<p>You should avoid coding in this way. It encourages problems because you might:</p>
<ul>
<li>copy-paste something incorrectly</li>
<li>forget to update the pasted code, or update it incorrectly</li>
<li>it can be hard to spot small deviations or errors quickly</li>
</ul>
<p>If your code works, then it works. But you should try to minimise mistakes and make it easier to interpret where possible. That will make your code more stable and reusable, which is particularly important if the code needs to be run again in future, like for a publication.</p>
<p>Functions are an important way of doing this in R.</p>

<h1 id="why-functions" class="govuk-heading-xl">Why functions?</h1>
<p>You should write your own function instead of writing repetitive code. Read more about the case for functions in <a href="https://r4ds.had.co.nz/functions.html" class="govuk-link"  target="_blank" rel="noreferrer noopener">the Functions chapter of <em>R for Data Science</em> by Hadley Wickham</a>.</p>
<p>Functions are special structures in R that let you:</p>
<ul>
<li>write repetitive code just once</li>
<li>assign an informative name to that code for easier reuse</li>
<li>eliminate copy-paste errors</li>
<li>improve the readability of your code</li>
<li>make testing and debugging easier</li>
</ul>
<p>R is a function-oriented language, which means almost everything is a function. You&rsquo;ll be familiar with functions that are built into R, like <code>print()</code> and <code>c()</code>, but we can also make our own.</p>
<p>Rule of thumb: if you need to copy-paste some code more than twice, it should probably be a function. This is especially true when the code is long or complicated.</p>

<h2 id="write-a-function" class="govuk-heading-l">Write a function</h2>
<p>You should write small functions that do one specific thing. This makes it easier to reuse and debug them. In our example, all the code is doing is saving some filtered data.</p>
<p>So, instead of the repetitive code in the example above, you should write a function that takes the dataset and organisation name as :</p>
<pre><code class="language-{r}" data-lang="{r}">write_org_file &lt;- function(org) {
  
  df %&gt;% 
    filter(OverallDeptCode == org) %&gt;%
    write_csv(
      paste0(&quot;output/csps-&quot;, org, &quot;-results.csv&quot;)
    )

}
</code></pre><p>For specific advice on function best-practice see <a href="" class="govuk-link" >the &lsquo;writing good functions&rsquo;  section</a>.</p>
<p>You could then use the function like this:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-r" data-lang="r"><span class="nf">write_org_file</span><span class="p">(</span><span class="s">&#34;ACAS&#34;</span><span class="p">)</span>
<span class="nf">write_org_file</span><span class="p">(</span><span class="s">&#34;AGO&#34;</span><span class="p">)</span>
<span class="nf">write_org_file</span><span class="p">(</span><span class="s">&#34;AIB&#34;</span><span class="p">)</span>
<span class="nf">write_org_file</span><span class="p">(</span><span class="s">&#34;ALOB&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>This is better than the original code: the function name tells us what the code does; we only supply the organisation name once; and it&rsquo;s more succinct, which makes it easier to spot any errors.</p>
<p>On face value, you still have to copy-paste the function call. We can, however, tell R to apply a function over a supplied vector or list of inputs. This makes your code far more succinct and readable</p>

<h2 id="iterate-the-function" class="govuk-heading-l">Iterate the function</h2>
<p>You should use the {purrr} package for iteration, particularly the <code>map()</code> functions. This is preferred to R&rsquo;s <code>apply</code> family of functions, which are inconsistent.</p>
<p>For example, you could use {purrr}&rsquo;s <code>walk()</code> function to supply each organisation to our example function in turn:</p>
<pre><code class="language-{r}" data-lang="{r}">walk(c(&quot;ACAS&quot;, &quot;AGO&quot;, &quot;AIB&quot;, &quot;ALOB&quot;), get_org_mean)
</code></pre><p>This does exactly the same thing as the example in the first code block of this page. In other words, we&rsquo;ve written one line of code instead of repeating the same code for every single one of the 100-plus organisations.</p>

<h1 id="storing-functions" class="govuk-heading-xl">Storing functions</h1>
<p>Where should the code for a function go? Small functions that solve a specific problem in your analysis scripts can be written alongside the rest of the code in your script. In the case of writing R Markdown files, you should prefer to store these in chunks at the top of your script, as per <a href="https://emilyriederer.netlify.app/post/rmarkdown-driven-development/" class="govuk-link"  target="_blank" rel="noreferrer noopener">the RMarkdown-Driven Development philosophy</a>.</p>
<p>If your function definition is long and complicated, or if the scale of your analysis is large and made of several separate scripts, you should probably annex the functions into their own R script file(s) and store them in a separate folder (typically called <code>R/</code>).</p>
<p>This makes them easier to find, reuse, test and debug. It also makes your analysis scripts easier to read because the function definitions are stored elsewhere.</p>
<p>It can, however, become difficult to manage a large number of functions. This is when you might need to develop your own package. Read more in <a href="" class="govuk-link" >the &lsquo;writing packages&rsquo; section</a>.</p>


</div>



                </div>

            </div>
        </main>
    </div><footer class="govuk-footer " role="contentinfo">
    <div class="govuk-width-container ">
        <div class="govuk-footer__meta">
            <div class="govuk-footer__meta-item govuk-footer__meta-item--grow">

                <h2 class="govuk-visually-hidden">Support links</h2>
                <ul class="govuk-footer__inline-list">

                    

                    
                    
                    <li class="govuk-footer__inline-list-item">
                        <a class="govuk-footer__link" href="https://co-analysis.github.io/coding-guide/accessibility/">
                            Accessibility
                        </a>
                    </li>
                    
                    
                    
                    <li class="govuk-footer__inline-list-item">
                        <a class="govuk-footer__link" href="https://co-analysis.github.io/coding-guide/cookies/">
                            Cookies
                        </a>
                    </li>
                    
                    
                    
                    
                    <li class="govuk-footer__inline-list-item">
                        Built by <a class="govuk-footer__link" href="https://www.github.com/co-analysis">
                            Cabinet Office Analysis &amp; Insight
                        </a>
                    </li>
                    

                </ul>

                <svg aria-hidden="true" focusable="false" class="govuk-footer__licence-logo"
                    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 483.2 195.7" height="17" width="41">
                    <path fill="currentColor"
                        d="M421.5 142.8V.1l-50.7 32.3v161.1h112.4v-50.7zm-122.3-9.6A47.12 47.12 0 0 1 221 97.8c0-26 21.1-47.1 47.1-47.1 16.7 0 31.4 8.7 39.7 21.8l42.7-27.2A97.63 97.63 0 0 0 268.1 0c-36.5 0-68.3 20.1-85.1 49.7A98 98 0 0 0 97.8 0C43.9 0 0 43.9 0 97.8s43.9 97.8 97.8 97.8c36.5 0 68.3-20.1 85.1-49.7a97.76 97.76 0 0 0 149.6 25.4l19.4 22.2h3v-87.8h-80l24.3 27.5zM97.8 145c-26 0-47.1-21.1-47.1-47.1s21.1-47.1 47.1-47.1 47.2 21 47.2 47S123.8 145 97.8 145" />
                </svg>
                <span class="govuk-footer__licence-description">
                    All content is available under the
                    <a class="govuk-footer__link"
                        href="https://www.nationalarchives.gov.uk/doc/open-government-licence/version/3/"
                        rel="license">Open Government Licence v3.0</a>, except where otherwise stated
                </span>
            </div>
            <div class="govuk-footer__meta-item">
                <a style="background-image:url(https://co-analysis.github.io/coding-guide/assets/images/govuk-crest.png);"
                    class="govuk-footer__link govuk-footer__copyright-logo"
                    href="https://www.nationalarchives.gov.uk/information-management/re-using-public-sector-information/uk-government-licensing-framework/crown-copyright/">Â©
                    Crown copyright </a>
            </div>
        </div>
    </div>
</footer>

<script type="text/javascript">

    function applyGOVUK(tag, govuk_class) {
        var elements = document.querySelector("div.dashboard-content").getElementsByTagName(tag)

        var i;
        for (i = 0; i < elements.length; i++) {
            if (elements[i].classList.contains("lntable") || elements[i].classList.contains("lntd")) {
                null;
            } else if (tag == "P" && (elements[i].classList.contains("govuk-body-l") || elements[i].classList.contains("govuk-body-s"))) {
                null;
            } else if (tag == "HR" && (elements[i].classList.contains("govuk-section-break"))) {
                null;
            } else {
                elements[i].classList.add(govuk_class);
            }

        };

    };

     
    applyGOVUK("P", "govuk-body");

     
    applyGOVUK("TABLE", "govuk-table");
    applyGOVUK("CAPTION", "govuk-table__caption");
    applyGOVUK("CAPTION", "govuk-table__caption--m");
    applyGOVUK("TR", "govuk-table__row");
    applyGOVUK("TD", "govuk-table__cell");
    applyGOVUK("THEAD", "govuk-table__head");
    applyGOVUK("TH", "govuk-table__header");

     
    applyGOVUK("BLOCKQUOTE", "govuk-inset-text");
    applyGOVUK("STRONG", "govuk-!-font-weight-bold");
    applyGOVUK("B", "govuk-!-font-weight-bold");

     
    applyGOVUK("UL", "govuk-list");
    applyGOVUK("UL", "govuk-list--bullet");
    applyGOVUK("OL", "govuk-list");
    applyGOVUK("OL", "govuk-list--number");

     
    applyGOVUK("HR", "govuk-section-break--l");
    applyGOVUK("HR", "govuk-section-break");

     
    function styleCodeBlocks() {
        var code_elements = document.querySelectorAll("div.highlight")
        var i;

        for (i = 0; i < code_elements.length; i++) {
            code_elements[i].classList.add("govuk-body");
        };
    };
    styleCodeBlocks();

     
    function restyleTOC() {

        var toc_elements = document.querySelectorAll("#page_toc #TableOfContents ul")

        var i;

        for (i = 0; i < toc_elements.length; i++) {
            toc_elements[i].classList.remove("govuk-list");
            toc_elements[i].classList.remove("govuk-list--bullet");
            toc_elements[i].classList.add("toc-list");

        };

        var toc_links = document.querySelectorAll("#page_toc #TableOfContents a")

        for (i = 0; i < toc_links.length; i++) {
            toc_links[i].classList.add("toc-link");
        };

    };
    restyleTOC();

    

</script></body>

</html>